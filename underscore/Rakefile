require "albacore"
require "./lib/underscore.rb"

specs = FileList["**/*.nuspec"]

task :default => [:compile]

desc "Compile the script"
ahk_compile :compile => [:output] do |cmd| 
  cmd.in = "underscore-script/tools/underscore.ahk"
  cmd.icon = "underscore-script/tools/underscore_on.ico"
  cmd.out = "underscore-compiled/tools/underscore.exe"
end

output :output do |out|
  out.from "underscore-script/tools"
  out.to "underscore-compiled/tools"
  out.file "underscore_off.ico"
  out.file "underscore_on.ico"
end

specs.each do |spec|
  exec spec do |cmd|
    cmd.command = "cpack"
    cmd.parameters = spec
  end
end

desc "Build all of the packages"
task :build => [:compile, specs].flatten

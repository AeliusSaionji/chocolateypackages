require "fileutils"

script   = "underscore-script/content/underscore.ahk"
icon     = "underscore-script/content/underscore_on.ico"
exe      = "underscore-compiled/content/underscore.exe"

specs    = FileList["**/*.nuspec"]
packages = FileList["*.nupkg"]

task :default => [:compile]

desc "Build all of the packages"
task :package => [:compile] do
  specs.each { |name| system "cpack #{name}" }
end

desc "Publish all of the packages"
task :publish => [:package] do
  packages.each { |name| system "cpush #{name}" }
end

desc "Compile the script to exe"
task :compile do
  system "ahk2exe /in \"#{script}\" /out \"#{exe}\" /icon \"#{icon}\""
  system "mpress -q \"#{exe}\""
end

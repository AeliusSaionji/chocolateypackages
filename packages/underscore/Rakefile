require "fileutils"

ahk2exe = File.join(ENV["SYSTEMDRIVE"], "Program Files/AutoHotkey/Compiler/ahk2exe.exe")

script   = "underscore-script/content/underscore.ahk"
icon     = "underscore-script/content/underscore_on.ico"
exe      = "underscore-compiled/content/underscore.exe"
content  = ["underscore_on.ico", "underscore_off.ico"]

specs    = FileList["**/*.nuspec"]
packages = FileList["*.nupkg"]

task :default => [:package]

desc "Build all of the packages"
task :package => [exe] do
  specs.each { |name| system "cpack #{name}" }
end

desc "Publish all of the packages"
task :publish => [:package] do
  packages.each { |name| system "cpush #{name}" }
end

file exe do
  content.each do |name| 
    source      = File.join("underscore-script/content", name)
    destination = File.join("underscore-compiled/content", name)

    FileUtils.cp_r(source, destination)
  end
  
  system "\"#{ahk2exe}\" /in #{script} /out #{exe} /icon #{icon}"
end

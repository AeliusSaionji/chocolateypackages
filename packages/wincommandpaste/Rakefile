require "fileutils"

script   = "wincommandpaste-script/content/wincommandpaste.ahk"
icon     = "wincommandpaste-script/content/wincommandpaste.ico"
exe      = "wincommandpaste-compiled/content/wincommandpaste.exe"

specs    = FileList["**/*.nuspec"]
packages = FileList["*.nupkg"]

task :default => [:package]

desc "Build all of the packages"
task :package => [exe] do
  specs.each { |name| system "cpack #{name}" }
end

desc "Publish all of the packages"
task :publish => [:package] do
  packages.each { |name| system "cpush #{name}" }
end

directory "wincommandpaste-compiled/content"

file exe => "wincommandpaste-compiled/content" do
  system "ahk2exe /in \"#{script}\" /out \"#{exe}\" /icon \"#{icon}\""
  system "mpress -q \"#{exe}\""
end

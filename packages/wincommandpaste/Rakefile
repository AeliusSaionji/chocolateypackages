require "fileutils"

script   = "wincommandpaste-script/content/wincommandpaste.ahk"
icon     = "wincommandpaste-script/content/wincommandpaste.ico"
exe      = "wincommandpaste-compiled/content/wincommandpaste.exe"

specs    = FileList["**/*.nuspec"]
packages = FileList["*.nupkg"]

task :default => [:compile]

desc "Build all of the packages"
task :package => [:compile] do
  specs.each { |name| system "cpack #{name}" }
end

desc "Publish all of the packages"
task :publish => [:package] do
  packages.each { |name| system "cpush #{name}" }
end

desc "Compile the script to ahk"
task :compile do
  system "ahk2exe /in \"#{script}\" /out \"#{exe}\" /icon \"#{icon}\""
  system "mpress -q \"#{exe}\""
end
